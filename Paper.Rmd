---
title: |
  | \LARGE{The Effect of Affordable Housing on Neighboring Property Values: }
  | \LARGE{Evidence from San Francisco's Inclusionary Housing Program \vspace{0.5cm}}
author: |
  | Eric Milstein and Tak Hogan
  | Applications of Econometric and Data Science Methods
date: "March 21, 2019"
bibliography: references.bib
output: pdf_document
fontsize: 11pt
fig_caption: yes
indent: true
geometry: margin=1in
header-includes:
- \usepackage{placeins}
- \usepackage{setspace}
- \usepackage{chngcntr}
- \onehalfspacing
- \usepackage{float}
- \floatplacement{figure}{H}


abstract: "This paper evaluates San Francisco's Inclusionary Housing Program by estimating the impact of affordable developments on assessed and predicted property values in the surrounding area. We use a unique panel dataset constructed from parcel-level tax assessments, American Community Survey microdata, and price estimates scraped from real estate listing service Zillow. Exploiting the city's mandate that all new developments either designate affordable units or pay an in-lieu fee, we use a difference-in-differences design to compare changes in surrounding property values between these two groups. We find that on average, property values _____ by _____ in areas that compared to those that ."

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.pos = 'H')
library(tigris)
library(gplots)
library(foreign)
library(car)
library(qwraps2)
library(knitr)
library(ggplot2)
library(plotrix)
library(stargazer)
library(doBy)
```

# Introduction

In the past decade, several American cities have instituted inclusionary housing policies to combat rising rents and inequality. These policies require a given share of new residential units constructed in a city to be made affordable to low or moderate-income residents. State and local governments implement such standards through various means, including mandatory requirements, voluntary and incentive-based programs, direct subsidies to developers, and geographically determined zoning laws.

Inclusionary programs are broadly popular among policymakers, urban planners, and advocates of affordable housing. These groups view such programs as a way to maintain neighborhood economic diversity and prevent cities from pricing out low-income residents. However, inclusionary policies are generally unpopular among real estate developers and have encountered opposition from economists. Critics argue that inclusionary regulations artificially restrict the supply of market-rate units in a city, drive up rents, and reduce the incentive for developers to build new housing. According to this line of thought, aside from a few lucky low-income families that obtain affordable units, the majority of a city's residents are made worse off by such policies.

San Francisco’s housing market is widely viewed as being in a state of crisis, with rents and property values rising to record levels in recent years. Commentators have suggested several contributing factors, including the influx of population associated with the city's rapid economic growth, strict zoning laws that limit high-density development, resistance from neighborhood groups, high costs of construction, and difficulties in obtaining permits and environmental approval for new developments.

In 2002, the City of San Francisco established the Inclusionary Housing Program, which has since become one of nation’s largest and longest-running affordable housing programs. Guided by Section 415 of the city's planning code, the program requires housing developers that propose a new residential project with 10 or more units to either reserve a percentage of units to be rented or sold below-market rate, fulfill this requirement at a different building they own, or pay an in-lieu fee. Developers are also offered the opportunity to pursue some combination of these requirements.

### San Francisco's Inclusionary Housing Program


# Literature Review

Few empirical studies have been conducted into the effects of inclusionary housing policies. While there have been several policy reports and feasibility/cost-benefit analyses, there is little academic literature. Some of the potential barriers to research include the small scope of these programs, the recency of their implementation, a lack of available data, and legal complexities in evaluating the effects of these policies. However, there is related literature on other “place-based” policies (enterprise zones, neighborhood revitalization projects, etc.), spatial econometrics and spillover effects, rent control, and other affordable housing programs.
[@aliprantisBlowingItKnocking2015]


# Research Design

We propose to evaluate San Francisco’s Inclusionary Housing Program by leveraging the fact that the policy allows developers to pay an in-lieu fee instead of building affordable housing units. This creates a naturally-occurring treatment group (the developments that chose to build affordable housing) and control group (the developments that chose to pay the in-lieu fee). Considering all eligible housing developments in the city to be our unit of analysis, we plan to use a difference-in-differences approach to compare changes in home values in areas surrounding developments that built affordable housing vs. developments that were eligible but instead paid the fee/built off-site. In doing so, we can estimate the effect of the introduction of affordable units on neighborhood property values.

The obvious concern that arises with this approach is that developers select into the treatment and control groups based on unobservable factors that are difficult to estimate. For example, if developers believe that the neighborhood will experience rising housing prices in the future, they might choose to pay the in-lieu fee so that they can earn the full profits from selling/renting market-rate units in the future. In contrast, a developer that thinks the market will be relatively stagnant might choose to build affordable units and take the steady stream of profits instead of spending a large amount of money on the in-lieu fee. Therefore, the parallel trends assumption may not be valid since underlying neighborhood characteristics can influence developers’ decisions to build units vs. pay the fee.

### Model

$$\text{Y}_{it}=\alpha+\beta S_{i}+\gamma T_{t}+\delta(S_{i}\times T_{t})+\rho\mathbf{X}_{it}+\epsilon_{it}$$

$$
\begin{cases}
Y_{it} & \text{Median Property Values in Surrounding Area }\\
 & \text{at Time }t\\
S_{i} & \text{Section 415 Declaration Dummy (Affordable vs. Pay Fee)}\\
T_{t} & \text{Pre vs. Post Construction Dummy}\\
\mathbf{X}_{it} & \text{Vector of Covariates}
\end{cases}
$$

The difference-in-differences estimate:

$$\hat{\delta}_{DD}=\bar{Y}_{\text{post}}^{\text{affordable}}-\bar{Y}_{\text{pre}}^{\text{affordable}}-(\bar{Y}_{\text{post}}^{\text{pay fee}}-\bar{Y}_{\text{pre}}^{\text{pay fee}})$$

Interpreting coefficients 

$$\text{Y}_{it}=\alpha+\beta S_{i}+\gamma T_{t}+\delta(S_{i}\times T_{t})+\rho\mathbf{X}_{it}+\epsilon_{it}$$

$$\begin{cases}
\alpha & \text{Average pre-construction median surrounding property value }\\
 & \text{for non-affordable properties}\\
\beta & \text{Affordable housing-specific effect on surrounding property values }\\
\gamma & \text{Time trend common to both affordable and non-affordable properties }\\
\delta & \text{Diff-in-diff estimator: true effect of treatment}
\end{cases}$$



Assumption underlying diff-in-diff estimation: in the absence of affordable housing, property i's outcome at time t is given by:

$$E[Y_{i}|S_{i}=0,t=\tau]=\gamma_{i}+\lambda_{\tau}$$

Two implicit identifying assumptions:

• Selection bias relates to fixed characteristics of properties ($\gamma_{i}$)

• Time trend ($\lambda_{\tau}$) same for affordable and non-affordable properties

In our paper, we will first have to show that developers’ decisions are essentially random and not based on any other observable characteristics of the neighborhood, using a large number of underlying neighborhood/property characteristics from municipal datasets and census tract data from American Community Survey. We actually believe this is a valid assumption, since the in-lieu fee is calculated in a way that already incorporates information about the area and makes the developer’s decision less dependent on unobservables. However, we have several other concerns with our design, including difficulties in selecting appropriate controls, addressing temporal and spatial autocorrelation, and extending the model to a continuous treatment (since it is not just that developers are building affordable housing or not: it’s that they’re building a particular number of units). In addition, we are doubtful that the program is large enough to have a meaningful effect in either direction.

# Data Description

From the City of San Francisco’s open data portal, we have data on all inclusionary-eligible housing developments with geotags, dates of permit issuance and completion, and information about number and type of units. To evaluate home values in surrounding neighborhoods, we found a multi-year panel dataset
of property tax assessments in San Francisco with detailed parcel-level land and home values for every property in the city. We also plan to introduce various census tract-level control variables by linking this data with demographic, economic, and housing data from the American Community Survey.

Finally, we hope to obtain more detailed geocoded information on rental prices or transactions from listing agencies (e.g. Zillow, Redfin, Trulia). Although our current method is to estimate the effect of affordable developments on nearby property values, we would prefer to use sale prices/rents as our outcome variable. Since the home value metric is calculated by the city according to a designated formula, it is not necessarily the best way to evaluate the impact of affordable housing on the surrounding neighborhood.

![Relative Size of 100m, 200m, 300m Distance Bands on City Map](fig_satellite1.png){width=75%}


![Relative Size of 100m, 200m, 300m Distance Bands around Property](fig_satellite2.png){width=75%}

# Analysis

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Read in mean and median data, merge files
total_clean_mean_drop_zeros <- read.csv("../total_clean_mean_drop_zeros.csv")
total_clean_median_drop_zeros <- read.csv("../total_clean_median_drop_zeros.csv")
total_clean_median_drop_zeros$dist_100_mean <- total_clean_mean_drop_zeros$dist_100_mean
total_clean_median_drop_zeros$dist_200_mean <- total_clean_mean_drop_zeros$dist_200_mean
total_clean_median_drop_zeros$dist_300_mean <- total_clean_mean_drop_zeros$dist_300_mean

final.data <- total_clean_median_drop_zeros

# Fill in missing row
final.data[final.data$X==45646,]$dist_100_mean <- total_clean_mean_drop_zeros[total_clean_mean_drop_zeros$X==45646,]$merged_2014_100_mean
final.data[final.data$X==45646,]$dist_200_mean <- total_clean_mean_drop_zeros[total_clean_mean_drop_zeros$X==45646,]$merged_2014_200_mean
final.data[final.data$X==45646,]$dist_300_mean <- total_clean_mean_drop_zeros[total_clean_mean_drop_zeros$X==45646,]$merged_2014_300_mean
final.data[final.data$X==45646,]$dist_100_median <- final.data[final.data$X==45646,]$merged_2014_100_median
final.data[final.data$X==45646,]$dist_200_median <- final.data[final.data$X==45646,]$merged_2014_200_median
final.data[final.data$X==45646,]$dist_300_median <- final.data[final.data$X==45646,]$merged_2014_300_median

# Encode time and treatment dummies
final.data$time <- ifelse(final.data$year_index >= 1, 1, 0)
final.data$treated <- ifelse(final.data$simple415 == "On-site BMR Project", 1, 0)
final.data$did = final.data$time * final.data$treated

no.outliers <- final.data[final.data$LocationKey != "(37.79054, -122.3959)",]
```

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}

m1 <- lm(log(dist_100_median) ~ treated + time + did, data = final.data)
m2 <- lm(log(dist_200_median) ~ treated + time + did, data = final.data)
m3 <- lm(log(dist_300_median) ~ treated + time + did, data = final.data)

m4 <- lm(log(dist_100_mean) ~ treated + time + did, data = final.data)
m5 <- lm(log(dist_200_mean) ~ treated + time + did, data = final.data)
m6 <- lm(log(dist_300_mean) ~ treated + time + did, data = final.data)
 
stargazer(m1, m2, m3, type='latex', 
          dep.var.labels=c("Log(100m Median)","Log(200m Median)", "Log(300m Median)"),
          covariate.labels=c("On-Site Affordable Housing", "Post-Treatment", "Diff-in-Diff Estimator", "Constant"),
          font.size="small", header=FALSE)

stargazer(m4, m5, m6, type='latex', 
          dep.var.labels=c("Log(100m Mean)","Log(200m Mean)", "Log(300m Mean)"),
          covariate.labels=c("On-Site Affordable Housing", "Post-Treatment", "Diff-in-Diff Estimator", "Constant"),
          font.size="small", header=FALSE)

```

```{r}

# Visualize diff in diff model

year_means <- summaryBy(dist_300_median ~ treated + year_index, data=final.data, FUN=c(length,median,sd))
ggplot(data=year_means, aes(x=year_index,y=dist_300_median.median)) + geom_point() + 
    geom_line(data = year_means[year_means$treated==1,], aes(x = year_index, y = dist_300_median.median), color = "blue") +
  geom_line(data = year_means[year_means$treated==0,], aes(x = year_index, y = dist_300_median.median), color = "red") + xlim(-2,2) + geom_vline(xintercept=0)



```


- Run separate regressions: subset data to only t-1, t+1, etc.

# References
